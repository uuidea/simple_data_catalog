= Server side MathJax rendering for Asciidoctor.js/Antora
:version: 0.0.9

`@djencks/asciidoctor-mathjax` provides an Asciidoctor.js extension to replace the built-in HTML asciidoctor stem processing with server-side rendering of AsciiMath and LaTeX Math expressions using the Mathjax 3 JavaScript library.
Output is inline SVG included in the final HTML document.
The intent is that configuration is identical to built-in stem processing.

Since MathJax stem support is not included in the Antora default UI, this may be a more convenient option for Antora than modifying the UI.

== Installation

Available through npm as `@djencks/asciidoctor-mathjax`.

The project git repository is: https://gitlab.com/djencks/asciidoctor-mathjax.js

== Usage in Asciidoctor.js

I am not a standalone Asciidoctor.js expert, so I will only quote one of the tests:

[source,js]
----
const mathJaxProcessor = require('@djencks/asciidoctor-mathjax')
const asciidoctor = require('@asciidoctor/core')()

const registry = mathJaxProcessor.register(asciidoctor.Extensions.create())
const html = asciidoctor.convert(`
:stem:

A matrix can be written as

[stem]
++++
[[a,b],[c,d]]((n),(k))
sqrt(4) = 2
sqrt(9) = 3
++++
`, { extension_registry: registry })

console.log(html)
----

== Usage in Antora

Install this extension so it is visible to Antora.

=== Global installation

This is most useful if your project is not developed by a lot of people who need automated setup.

Run `npm i -g @djencks/asciidoctor-mathjax`.
This will fetch and install the extension usable in all your Antora projects.

=== Local installation

This provides automated setup for your project from a git clone, all your users have to do is run `npm i`.
However, while it provides more precise version control of your dependencies, it adds a node_modules directory in your playbook project.

Add a package.json file for your Antora project, next to the playbook.
Here's an example:

[source,json,subs="+attributes"]
----
{
  "private": true,
  "scripts": {
    "build": "antora antora-playbook.yml --fetch --stacktrace"
  },
  "devDependencies": {
    "@djencks/asciidoctor-mathjax": "^{version}"
  }
}
----

The script is unnecessary but convenient.
You can also list the antora cli and site-generator-default in devDependencies and use this to install Antora.

* Run `npm i` to install this extension
** With the above, run `npm run build` to run Antora to build your site.

=== Add the extension to the playbook

* List the extension in the antora playbook:
----
asciidoc:
  extensions:
  - '@djencks/asciidoctor-mathjax'
----

== Antora Example project

A fairly complete example project showing all the possible stem locations and configurations is under extensions/mathjax in `https://gitlab.com/djencks/simple-examples`.

== Configuration

Configuration is currently through doc attributes.
In Antora, I suggest you set these in the playbook.

stem:: As in Asciidoctor, you can set the default stem processor through the 'stem' attribute.
Possible values are 'latexmath' and 'asciimath'.

mathjax-tex-packages:: Set the tex packages to load, e.g. ':mathjax-tex-packages: ams physics'.
This must be set in the playbook or as a doc attribute.

NOTE: Loading 'autoload' appears to work, but it will break any use of asciimath in your entire Antora project.

mathjax-tex-tags:: Set the tex 'tags' attribute.
Allowed values are 'none' (default), 'ams' (requires the ams package), and 'all'. This controls equation numbering.
In Antora, equations are numbered per-page.

== Additional comments

Line break support with '\\' is not ported from MathJax 2 to 3.
To get line breaks with '\\', enclose your latex in one of:

* '\displaylines{...}' (always available) (horizontally centered lines, no line numbers) or
* '\begin{ ... }...\end{ ... }' (requires the ams package) with one of these environments:
** gather -- horizontally centered lines, line numbers
** align -- more or less right aligned lines unless you use explicit &, line numbers
** align* -- right aligned without &, no line numbers
** aligned -- right aligned without &, no line numbers
** alignat -- right aligned without &, line numbers.
